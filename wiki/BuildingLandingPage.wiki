#summary Building the landing page

We discussed about [SoYouHaveAnIdea putting an application ideas in writing],  [GettingStarted setting up the development environment], and [DataModeling data modeling]. Coding time!

<wiki:toc max_depth="2" />

Download and unpack [http://gwt-gae-book.googlecode.com/svn/trunk/CultureShows-0.1.tgz the basic project] already setup for you and do `File > Import > Existing Projects` from Eclipse. Run it to make sure it's working.

For now we'll focus on building the landing page only, feel free to ignore the rest of the files in the template project. We'll cover them later.

= Mockup =

Here's how the landing page might look

<img src="http://gwt-gae-book.googlecode.com/svn/wiki/assets/landing.png" border="1"  />

There is some reading you have to do in advance for each section below, but it's worth it.

= Page Layout =
<img src="http://gwt-gae-book.googlecode.com/svn/wiki/images/grunge.jpg" border="0"  align="right" />
There are two approaches to setup a page layout in GWT:
 * [http://www.noobcube.com/tutorials/html-css/fixed-header-footer-layout-a-beginners-guide-/ using just HTML and CSS], with [http://code.google.com/webtoolkit/doc/latest/DevGuideUiPanels.html#BasicPanels RootPanel]. 
 * [http://code.google.com/webtoolkit/doc/latest/DevGuideUiPanels.html#LayoutPanels using GWT LayoutPanels], with !RootLayoutPanel. This approach introduces additional div tags, which contribute to tag soup and [http://www.devcomments.com/RootPanel-vs-RootLayoutPanel-at197454.htm sometimes] prevent [http://groups.google.com/group/google-web-toolkit/browse_thread/thread/c8cfc4d2dba16862# proper firing of events] on some elements. See also [http://www.zackgrossbart.com/hackito/antiptrn-gwt2/ using GWT for layout] (controversial).

We'll go with the first, standards-based approach. You will use your existing CSS knowledge, or learn it now if needed. CSS will benefit you when developing any web application, not just GWT-based ones.



*Pre-requisites*
 * [http://code.google.com/webtoolkit/doc/latest/DevGuideUi.html Build User Interfaces], including [http://code.google.com/webtoolkit/doc/latest/DevGuideUiBinder.html Declarative Layout with UiBinder] 
 * [http://code.google.com/webtoolkit/doc/latest/RefWidgetGallery.html Widget List]
 * [http://gwt.google.com/samples/Showcase/Showcase.html GWT showcase] to see some widgets in action
 * [http://code.google.com/webtoolkit/doc/latest/RefGWTClassAPI.html GWT API Reference] - bookmark this and keep it handy
 * [http://www.w3schools.com/css/default.asp CSS Tutorial]
 * [http://csstipsandtricks.com CSS Tips & Tricks]

First, let's add [http://code.google.com/p/gwt-gae-book/source/browse/#svn/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/resources an image] in Resources.java
{{{
	@Source("Theatre_Masks.png")
	ImageResource logo();
}}}


= Exercise: build the mocked up UI =
Open `LandingView.ui.xml` and try to implement the mocked up UI. No need to implement any Java logic yet, just focus on widgets and styling. Continue only when you have a draft version done by yourself.  

= Implementation =


[http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/landing/LandingView.ui.xml LandingView.ui.xml]

{{{
<!DOCTYPE ui:UiBinder SYSTEM "http://dl.google.com/gwt/DTD/xhtml.ent">
<ui:UiBinder xmlns:ui="urn:ui:com.google.gwt.uibinder"
	xmlns:g="urn:import:com.google.gwt.user.client.ui"
	xmlns:gcell="urn:import:com.google.gwt.user.cellview.client"
	xmlns:gdp="urn:import:com.google.gwt.user.datepicker.client"
	ui:generateFormat='com.google.gwt.i18n.rebind.format.PropertiesFormat'
	ui:generateKeys="com.google.gwt.i18n.rebind.keygen.MD5KeyGenerator"
	ui:generateLocales="default"
	>

	<ui:with type="org.gwtgaebook.CultureShows.client.NameTokens" field="nameTokens" />
	<ui:with field='res' type='org.gwtgaebook.CultureShows.client.resources.Resources' />


	<ui:image field="google" src="../resources/google.png" />
	<ui:image field="yahoo" src="../resources/yahoo.png" />


	<ui:style>

	.sideNavContent {
		float: right;
		width: 25%;
		margin-top: 1em;
		padding: 1em 1em;
		word-wrap: break-word;

		background-color: #e8f0de;
		-webkit-border-radius: .5em;
		-moz-border-radius: .5em;
		border-radius: .5em;
		-webkit-box-shadow: 0 1px 2px rgba(0,0,0,.2);
		-moz-box-shadow: 0 1px 2px rgba(0,0,0,.2);
		box-shadow: 0 1px 2px rgba(0,0,0,.2);
	}


	.specificContent {
		float: left;
		width: 65%;
		padding: 3em 0 0 1em;
	}



	.specificContent::after {
		clear: both;
		display: block;
	}

	.center {
	    margin: 1em auto;
	    text-align: center;

	}

	.provider {
		cursor: pointer;
	    margin: 1em auto;
		display: block;
		-webkit-border-radius: .5em;
		-moz-border-radius: .5em;
		border-radius: .5em;
		-webkit-box-shadow: 0 1px 2px rgba(0,0,0,.2);
		-moz-box-shadow: 0 1px 2px rgba(0,0,0,.2);
		box-shadow: 0 1px 2px rgba(0,0,0,.2);
		border: solid 1px #538312;
		/* TODO padding doesn't work, image is always top-left */
	}

	</ui:style>

    <g:HTMLPanel ui:field="container">

	    <g:HTMLPanel addStyleNames="{style.specificContent}">
		Schedule theater performances and other events, and easily embed them on your website.

		<ul>
			<li>real time updates: your website reflects any changes automatically</li>
			<li>be independent from other persons: no need to ask somebody else to publish your updates</li>
		</ul>
	    </g:HTMLPanel>

	    <g:HTMLPanel ui:field="signInContainer" addStyleNames="{style.sideNavContent}" visible="false">
			<g:HTMLPanel addStyleNames="{style.center}">
			<b>Sign in</b><br/>with your existing account
				<g:Image ui:field="googleSignIn" altText="Google" addStyleNames="{style.provider}" resource="{google}" />
				<g:Image ui:field="yahooSignIn" altText="Yahoo" addStyleNames="{style.provider}" resource="{yahoo}" />
			</g:HTMLPanel>

			<g:HTMLPanel addStyleNames="{style.center}">
				<a href="https://www.google.com/accounts/NewAccount" target="_blank">Create an account</a>
			</g:HTMLPanel>

		</g:HTMLPanel>

    </g:HTMLPanel>

</ui:UiBinder>
}}}


We also added various styles in  [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/resources/main.css main.css] , to be used in all application, and listed style names in  [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/resources/Resources.java Resources.java]

Here's the result :)

[http://gwt-gae-book.googlecode.com/svn/wiki/assets/landingApp.png]

As with any other section, make sure you understand what's happening before going further. Use the provided links to docs and Google to search for something else. 


= Using native !JavaScript =

There are cases when you might want to use native !JavaScript rather than pure GWT, such as the one above. See [http://code.google.com/webtoolkit/doc/latest/DevGuideCodingBasicsJSNI.html JavaScript Native Interface] and an example of  [http://www.zackgrossbart.com/hackito/antiptrn-gwt2/ building custom GWT widgets which include native JavaScript]. JSNI is a good choice when you want to reuse existing larger !JavaScript functionality (e.g. jQuery plugins) with easy upgrades to new versions, or sharing your code with other pure !JavaScript users. Note that using native !JavaScript will prevent you from using pure !JUnit test cases and you will need to use GWTTestCase, which is slower. Usage of native !JavaScript should be minimized whenever possible.

If you are looking for jQuery-like functionality in GWT, there's [http://code.google.com/p/gwtquery/ gwtQuery] ([http://www.youtube.com/watch?v=sl5em1UPuoI video introduction]). gwtQuery is a better choice when you're writing functionality from scratch as it gives you all GWT advantages over native !JavaScript. 

Again, use the best tool for the job. Therefore an important criteria selection for your tool set should be allowing easy inter-operating with other tools.

An early version of the Landing page used a !jQuery HTML5 placeholder plugin for form fields. [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/war/main.html?r=372 main.html] contained the jQuery plugin, and [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/landing/LandingView.java?r=184 the view] added HTML5 placeholder attributes and activates jQuery plugin via [http://code.google.com/webtoolkit/doc/latest/DevGuideCodingBasicsJSNI.html JSNI]. This functionality was later removed.


= Mobile, tablets, TV and other devices =

<img src="http://gwt-gae-book.googlecode.com/svn/wiki/images/quijote1.jpg" border="0"  align="right" />

Sometimes, you might want to have different views for different screen sizes. The styling above is liquid (resize browser window to try it out) and it works for now. We could have used [http://www.webdesignerwall.com/tutorials/css3-media-queries/ CSS3 media queries] to hide completely some information on small screens. See [http://www.smashingmagazine.com/2010/07/19/how-to-use-css3-media-queries-to-create-a-mobile-version-of-your-website/ another tutorial]. Media queries support [http://groups.google.com/group/google-web-toolkit/browse_thread/thread/86047ca5c364679f/2871b1e5e35be0d1 is still missing] from GWT.


= Model-View-Presenter (MVP) =

Besides the few files we worked with so far, the template project contains several more. Let's learn about

 * [http://code.google.com/webtoolkit/articles/mvp-architecture.html MVP architecture]
 * [http://code.google.com/p/gwt-platform/wiki/GettingStarted Getting started with gwt-platform]
 * [http://code.google.com/webtoolkit/doc/latest/DevGuideMvpActivitiesAndPlaces.html GWT MVP Framework]
 * [http://code.google.com/p/gwt-platform/wiki/ComparisonWithGwtMVP Comparison of gwt-platform with GWT MVP]
 * [http://martinfowler.com/eaaDev/uiArchs.html GUI Architectures]
 * [http://code.google.com/p/google-guice/ Guice dependency injection framework]
 * [http://code.google.com/p/google-gin/wiki/GinTutorial Gin dependency injection for GWT]
 * [http://arcbees.wordpress.com/2010/09/03/reversing-the-mvp-pattern-and-using-uihandler/ Reversing the MVP pattern and using @UiHandler]
 * [http://arcbees.wordpress.com/2010/09/18/uihandlers-and-supervising-controlers/ UiHandlers and supervising controller]

Think of !UiHandlers as a contract signed by Presenter: this is what Presenter has to offer, usable by others (usually Views). The Presenter also requires Views to offer something:
{{{
	public interface MyView extends View, HasUiHandlers<LandingUiHandlers> {
		public void setUserInfo(UserInfo userInfo);
	}
}}}
You can switch different Presenter and View implementations without any worries as long as they respect these contracts.

Now review all files in the template project. Do they make full sense? 

== Exercise ==
Using what you learned above, create a new "performances" package, with [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/#CultureShows/client/performances a View and a Presenter], and start implementing saving a performance when "Schedule performance" button is clicked. For now, it should just log a message in Presenter with the date, location and show name.

== Exercise solution ==

In [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/performances/PerformanceUiHandlers.java PerformanceUiHandlers], the Presenter commits to offer some functionality:
{{{
public interface PerformanceUiHandlers extends UiHandlers {
	public void createPerformance(Date date, String showName,
			String locationName);
}
}}}

After you save this, notice there is an error in !PerformancePresenter:
{{{
The type PerformancePresenter must implement the inherited abstract method
PerformanceUiHandlers.createPerformance(Date, String, String)
}}}

Let's actually keep our commitment and implement this:
{{{
	@Override
	public void createPerformance(Date date, String showName,
			String locationName) {
		Main.logger.info("Requested performance scheduling on "
				+ date.toString() + ": show " + showName + " at location "
				+ locationName);
	}
}}}

Here's how it's used by the View
{{{
	@UiField
	TextBox show;
	@UiField
	TextBox location;
	@UiField
	DateBox date;

	@UiHandler("createPerformance")
	void onCreatePerformanceClicked(ClickEvent event) {
		getUiHandlers().createPerformance(date.getValue(), show.getValue(),
				location.getValue());
	}
}}}

Run and test this functionality. In Development Mode Eclipse tab you'll see
{{{
... [INFO ] Requested performance scheduling on Fri Oct 22 12:00:00 EEST 2010: show Dream at location Rapsodia
}}}

Note there are no widgets or other UI elements from View exposed in Presenter. The Presenter should not care about UI elements, only about data the View exposes. You can have different Views for different devices, or mocked Views for unit tests.

[http://code.google.com/p/gwt-gae-book/source/browse/#svn/trunk/CultureShows Browse the full source code]

= Additional resources =
[http://www.openclipart.org Open Clip Art Library]

[http://www.sxc.hu/ Stock.XCHNG free stock photos] 

[http://www.smashingmagazine.com Smashing Magazine]

[http://www.alistapart.com/articles/fluidgrids/ Fluid grids] 

[http://www.webdesignerwall.com/tutorials/css3-gradient-buttons/ Gradient buttons]

[http://www.mezzoblue.com/zengarden/resources/ CSS Zen Garden resources]

[http://www.colorcombos.com/combolibrary.html Color combos]

<wiki:comment>NAV_START</wiki:comment>
<a href='http://code.google.com/p/gwt-gae-book/issues/entry'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/envelope.png' border='0' title='Send feedback' /></a>
<img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/spacer.png' border='0' />
<a href='http://code.google.com/p/gwt-gae-book/wiki/DataModeling'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/prev.png' border='0' title='Previous chapter: Data modeling' /></a>
<a href='http://code.google.com/p/gwt-gae-book/wiki/TableOfContents'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/contents.png' border='0' title='Table Of Contents' /></a>
<a href='http://code.google.com/p/gwt-gae-book/wiki/ClientServer'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/next.png' border='0' title='Next chapter: Client-server communication' /></a>
<wiki:comment>NAV_END</wiki:comment>