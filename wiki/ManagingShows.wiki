#summary Managing shows

We discussed about [SoYouHaveAnIdea clarifying your ideas before writing code] and [GettingStarted setting up the development environment]. We built [BuildingLandingPage a landing page] which [ClientServer communicates with App Engine back-end] and [Authentication authenticates members], and implemented [ManagingPerformances managing performances schedule], resulting in [http://cultureshows.appspot.com/ a sample application] with [QualityAssurance reasonable quality].

In this chapter we'll implement managing theater shows.

<wiki:toc max_depth="2" />

= Mockup =

Here's how managing shows UI could look

<img src="http://gwt-gae-book.googlecode.com/svn/wiki/assets/shows.png" border="2" style="border: 2;" />

Note the introduction of Performances and Shows navigation at the top.

= Client side functionality =


*Pre-requisites*
 * [http://code.google.com/p/gwt-platform/wiki/GettingStarted?tm=6#Blocking_some_presenters GWTP gatekeepers]


Since accessing the Shows view requires to be signed in, let's add a [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/SignedInGatekeeper.java gatekeeper]:

<img src="http://gwt-gae-book.googlecode.com/svn/wiki/images/venetian_mask_female.jpg" border="0"  align="right" />

{{{
public class SignedInGatekeeper implements Gatekeeper {

	@Inject
	private ClientState clientState;

	@Override
	public boolean canReveal() {

		if (null != clientState.userInfo) {
			if (clientState.userInfo.isSignedIn) {
				return true;
			}
		}

		return false;
	}
}
}}}


We'll basically duplicate [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/performances/  the performances package] structure. Here are the steps:
 * create a `shows` package, with the same files as in `performances`, and change the class names
 * add [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/shows/ShowModule.java ShowModule] to the [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/MainGinjector.java Gin Injector]
 * add `SignedInGatekeeper` and `ShowPresenter` to [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/MainGinjector.java MainGinjector]
 * add a new "shows" [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/NameTokens.java name token]


As shows view isn't needed on the very first access of the landing page, we'll also [http://code.google.com/webtoolkit/doc/latest/DevGuideCodeSplitting.html split its code] into separate files, to be loaded by GWT on demand, with `@ProxyCodeSplit` annotation:
{{{
public class ShowPresenter extends
		Presenter<ShowPresenter.MyView, ShowPresenter.MyProxy> implements
		ShowUiHandlers {

	@ProxyCodeSplit
	@NameToken(NameTokens.shows)
	@UseGatekeeper(SignedInGatekeeper.class)
	public interface MyProxy extends ProxyPlace<ShowPresenter> {
	}

	...
}
}}}

This requires using an [http://code.google.com/p/google-gin/source/browse/trunk/src/com/google/gwt/inject/client/AsyncProvider.java AsyncProvider] for `ShowPresenter` in [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/MainGinjector.java MainGinjector]
{{{
	AsyncProvider<ShowPresenter> getShowPresenter();
}}}



= Server side functionality =

We'll also use the `GetPerformances` and `ManagePerformance` as a reference on server-side. To implement the `Show` equivalent of these:
 * create [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/#CultureShows/shared/dispatch Action/Result generators]
 * create [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/#CultureShows/server/dispatch Action handlers]
 * bind handlers to actions in [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/server/MainHandlerModule.java MainHandlerModule]


And here's the result

<img src="http://gwt-gae-book.googlecode.com/svn/wiki/assets/manageShows.png" border="0" />

We have some code duplicated for Shows and Performances both for client and server. In a later chapter, we'll work on minimizing this.

*Additional resources*
 * [http://jcheng.wordpress.com/2010/02/16/elegant-code-splitting-with-gwt/ Elegant code splitting]


<wiki:comment>NAV_START</wiki:comment>
<a href='http://code.google.com/p/gwt-gae-book/issues/entry'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/envelope.png' border='0' title='Send feedback' /></a>
<img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/spacer.png' border='0' />
<a href='http://code.google.com/p/gwt-gae-book/wiki/QualityAssurance'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/prev.png' border='0' title='Previous chapter: Quality assurance' /></a>
<a href='http://code.google.com/p/gwt-gae-book/wiki/TableOfContents'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/contents.png' border='0' title='Table Of Contents' /></a>
<a href='http://code.google.com/p/gwt-gae-book/wiki/ExposingData'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/next.png' border='0' title='Next chapter: Exposing read-only data to 3rd parties' /></a>
<wiki:comment>NAV_END</wiki:comment>