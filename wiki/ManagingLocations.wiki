#summary Managing locations with REST APIs

We discussed about [SoYouHaveAnIdea clarifying your ideas before writing code] and [GettingStarted setting up the development environment]. We built [BuildingLandingPage a landing page] which [ClientServer communicates with App Engine back-end] and [Authentication authenticates members], and implemented [ManagingPerformances managing performances schedule], resulting in [http://cultureshows.appspot.com/ a sample application] with [QualityAssurance reasonable quality]. We've also added [ManagingShows theater show management] and enabled theater owners to [ExposingData display performances on their own websites] with the help of an YQL mashup.

Next, we'll cover REST web services.
 
<wiki:toc max_depth="2" />


= About REST =

Web services have several [http://en.wikipedia.org/wiki/Web_service#Styles_of_use styles of use]. So far we used [http://en.wikipedia.org/wiki/Remote_procedure_call remote procedure calls] to manage shows and other client-server interaction. 

[http://en.wikipedia.org/wiki/Representational_State_Transfer REST], with [http://en.wikipedia.org/wiki/JSON JSON] data format, is now the de facto architecture of web services. We will manage theater locations using a REST architecture.

= Exposing REST web services with App Engine = 
[ExposingData We already saw] how to implement reading the performances list with REST. Following the same pattern, locations APIs are built by
 * implementing  [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/server/api/LocationsResource.java Locations] and [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/server/api/LocationResource.java Location] resources
 * [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/server/APIRouter.java attaching routes] from URLs to resources


= Consuming REST services with GWT =
Besides [http://code.google.com/p/gwt-platform/ GWTP dispatch], we'll use [http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/http/client/RequestBuilder.html RequestBuilder] and [http://code.google.com/p/piriti/ piriti] to work with REST services from GWT. 

After implementing some [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/#client%2Fdispatch generic helper classes], in order to handle each client-server call we should 
 # define [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/locations/#locations%2Fmodel JSON models] for sending and receiving data (see [http://code.google.com/p/piriti/issues/detail?id=22 proposed enhancement])
 # write a [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/locations/dispatch/ReadLocations.java generator for Action and Result data]
 # write [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/locations/dispatch/ a handler] which
  * sets `RequestBuilder` data (url, headers, body)
  * extracts the result by parsing the response body according to given model (this is generic, might be implemented by `AbstractRequestBuilderClientActionHandler`)
 # [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/RESTHandlerRegistry.java register the handler] (see [http://groups.google.com/group/gwt-platform/browse_thread/thread/df016bb90190f9af# discussion])
 # [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/locations/LocationPresenter.java run] gwtp `dispatch.execute()` (easy to re-use, e.g. by [http://code.google.com/p/gwt-gae-book/source/browse/trunk/CultureShows/src/org/gwtgaebook/CultureShows/client/performances/PerformancePresenter.java locations auto-suggest])

This approach needs to be [http://groups.google.com/group/gwt-platform/browse_thread/thread/df016bb90190f9af/306d24f851e7c56a#306d24f851e7c56a enhanced] with a specific REST dispatcher, e.g. the current one still goes through `com.google.gwt.user.client.rpc.*`

Question: how about using just a `RequestBuilder` wrapper, without gwtp-dispatch?

= RPC vs REST =

<img src="http://gwt-gae-book.googlecode.com/svn/wiki/images/doi_dintre_noi6.jpg" border="0"  align="right" />

When implementing GWT/GAE apps, should one use RPC or REST?

The RPC advantage is 1st class support in GWT/GAE, requiring now less dependencies and code to write than implementing a similar functionality using REST.

REST has many advantages though:

 * When you are done implementing your required app functionality, you also end up with APIs usable by 3rd parties. Others could integrate with your back-end through these APIs. You and others will be able to build more front-ends if desired (e.g. native Android/iPhone apps, Flex etc). Thanks to APIs, [http://wordpress.chanezon.com/?p=158 innovation can happen elsewhere].
 * You can easily implement automated APIs functional and performance testing and monitoring with tools such as JMeter.
 * Easy to debug: with tools like Firebug, you can inspect directly in browser what happened on a call and identify the area with having the issue: client or server.
 * Being independent of specific technologies, you can easily completely replace the back-end or front-end implementation any time, as long as new ones support same APIs. You can also build just the back-end, or just the front-end, for your customers. (e.g. build a [http://twitpic.com/ twitpic] GWT client hosted anywhere, since they [http://en.wikipedia.org/wiki/List_of_Web_services_allowing_access_from_any_origin allow access from any origin])
 * Finally, as REST with JSON is standard on the web today, you can use the knowledge you gain for various other technologies.


Therefore, when building new GWT/GAE apps, I'd recommend to consider having two completely separate projects for back-end and front-end and use REST.


Let me conclude this section with a wish: Dear GAE and GWT developers, please make REST services simpler to expose from App Engine and consume from GWT. Some specific requests:
 * (GAE) have support for restlet-like functionality out of the box (or something like the internal tool shown at [http://www.youtube.com/watch?v=nyu5ZxGUfgs How Google builds APIs])
 * (GWT) support piriti-like functionality for working with JSON ([GWTREST piriti is easier to use than AutoBean])
 * (GWT) have a framework built around `RequestBuilder` and JSON for easily communicating with REST services (see the 5 steps above required now)


= Web services best practices =

Good web services are explorable ( maybe through a discovery API), predictable, consistent. Here are some best practices on building web services:

 * [http://www.youtube.com/watch?v=nyu5ZxGUfgs How Google builds APIs]
 * [http://www.youtube.com/watch?v=VVovVjT_H8A The interaction design of APIs]
 * [http://www.readwriteweb.com/hack/2010/11/clay-loveless-understanding-ap.php Understanding API Usage] 
 * [http://www.infoq.com/presentations/SOA-Business-Autonomous-Components Avoid a Failed SOA: Business & Autonomous Components to the Rescue]

Other practices include versioning, paging, filtering, working with API keys, protecting against DOS attacks, supporting partial operations and custom verbs, using standard microformats when possible.


= Additional resources =
 * [http://stackoverflow.com/questions/76595?tab=votes#tab-top SOAP vs. REST]
 * [GWTREST Alternatives on consuming REST services with GWT]
 * [http://code.google.com/p/tire-d8/ tire-d8], open source GWT/GAE project using a REST architecture
 * [http://www.crummy.com/writing/speaking/2008-QCon/act3.html What makes a REST service]. The implementation above is at level two, missing hyperlinks.
 * [http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven REST APIs must be hypertext-driven]

<wiki:comment>NAV_START</wiki:comment>
<a href='http://code.google.com/p/gwt-gae-book/issues/entry'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/envelope.png' border='0' title='Send feedback' /></a>
<img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/spacer.png' border='0' />
<a href='http://code.google.com/p/gwt-gae-book/wiki/ExposingData'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/prev.png' border='0' title='Previous chapter: Exposing read-only data to 3rd parties' /></a>
<a href='http://code.google.com/p/gwt-gae-book/wiki/TableOfContents'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/contents.png' border='0' title='Table Of Contents' /></a>
<a href='http://code.google.com/p/gwt-gae-book/wiki/AdditionalResources'><img src='http://gwt-gae-book.googlecode.com/svn/wiki/assets/next.png' border='0' title='Next chapter: Additional resources' /></a>
<wiki:comment>NAV_END</wiki:comment>